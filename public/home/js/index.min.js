$(function(){$(".block-video .has-danmu").showDanmu(),$(".module-video-big .has-danmu").showDanmu({lines:5,lineHeight:30});var a,t=function(a,t,e){var n=a,o=n.data().nav,i=n.closest("[data-tab]");t&&t(),n.addClass("active").siblings("a").removeClass("active"),i.find("[data-con]").addClass("hidden").filter('[data-con="'+o+'"]').removeClass("hidden")};$("[data-nav]").click(function(){var a=$(this),e=a.data().nav,n=a.closest("[data-tab]");n.hasClass("module-article")?t(a,function(){if(a.hasClass("active")){var t="/v/list"+e+"/index.htm";t=window.globalConfig.rootDomain?window.globalConfig.rootDomain+t:t,a.attr("href",t).attr("target","_blank")}else a.attr("href","javascript:;").removeAttr("target")}):t(a)}),$(".area-banana-rank .column-right .module-tab").on("mouseenter","a",function(){var e=$(this),n=e.data().nav,o=e.closest("[data-tab]");clearTimeout(a),a=setTimeout(function(){o.hasClass("module-article")?t(e,function(){if(e.hasClass("active")){var a="/v/list"+n+"/index.htm";a=window.globalConfig.rootDomain?window.globalConfig.rootDomain+a:a,e.attr("href",a).attr("target","_blank")}else e.attr("href","javascript:;").removeAttr("target")}):t(e)},150)});var e=$("#slider-big"),n=e.find(".slider-item"),o=e.find(".slider-con"),i=n.length;if(i>1){for(var r="",c=0;i>c;c++)r+="<span>"+(c+1)+"</span>";e.append('<div class="slider-count">'+r+"</div>");var d,s=0,l=function(a){var t=n.width();o.width(n.width()*i),o.animate({left:-t*a}),e.find(".slider-count span").eq(a).addClass("active").siblings("span").removeClass("active")},h=function(){d=setInterval(function(){l(s),s>=i-1?s=0:s++},3e3)};l(0),h(),e.hover(function(){clearInterval(d)},function(){s>=i-1?s=0:s++,h()}),e.on("click",".slider-count span",function(){s=$(this).index(),l(s)})}window.sa&&sa.track("HomePage",{from:document.referrer,firstPage:window.saObj.isFirstPage});var m=function(){var a=$("#temp-change-video").html(),t=$(a).addClass("[recommendClass]");return t[0].outerHTML}();$(".area-change-btn span").click(function(){var a=$(this),t=a.closest(".area-channel"),e=t.find(".module-video"),n=t.attr("data-cid"),o=e.attr("data-pagecount"),i=parseInt(e.attr("data-showlength")),r=t.find("script.json-channel-change"),c=a.closest(".area-change-btn"),d=50;if(c.hasClass("loading"))return!1;a.data().page=a.data().page||0,a.data().recommendData=$.parseJson(t.find("script.json-channel-recommend").html())||[],a.data().recommendPage=void 0==a.data().recommendPage?0:a.data().recommendPage,a.data().changeData=a.data().changeData||[],a.data().changeDataOld=$.parseJson(r.html())||[],a.data().changeStart=a.data().changeStart||0;var s={start:function(){c.addClass("loading")},stop:function(){setTimeout(function(){c.removeClass("loading")},1e3)}};s.start();var l=function(){var t=a.data().recommendPage,e=a.data().recommendData.slice(t*o,(t+1)*o);return e.length<=0&&(a.data().recommendPage=0,t>0&&(e=l())),e};a.data().recommendPage+=1;var h=function(){var t=l(),e=i-t.length,n=a.data().changeStart+e,o=a.data().changeData.slice(a.data().changeStart,n),r=e-o.length;if(r>0){if(!a.data().lock)return f(function(){g()}),!1;var c=a.data().changeData.slice(0,r);o=o.concat(c),n=r}return a.data().changeStart=n,t.concat(o).sort(function(){return Math.random()>.5?-1:1})},g=function(){var a=h();if(a){var t="";$.each(a,function(a,e){e.recommendClass=e.isCrown?"is-recommend":"",t+=$.parseTemp(m,e)}),e.html(t),e.find("img[data-original]").lazyload({threshold:200,effect:"fadeIn",failure_limit:50}),s.stop()}},f=function(t){$.getHttp("/index/change",{channelId:n,page:a.data().page+1},function(e){var n=e.data,o=n.hits,i=[];n.total<d?(a.data().lock=!0,i=$.removeRepeatObject(a.data().changeDataOld,o,"videoId"),i=i.concat(a.data().changeDataOld)):i=o,a.data().page=a.data().page+1,i=$.removeRepeatObject(a.data().recommendData,i,"videoId");var r=[];r=1==a.data().page?a.data().changeDataOld:a.data().changeData,i=$.removeRepeatObject(r,i,"videoId"),a.data().changeData=a.data().changeData.concat(i),t&&t()},function(){s.stop(),$.info.error("获取数据失败!")})};g()}),$(".indexMonkeyRightAd").click(function(){window.sa&&sa.track("JD618_PC")});var g=function(){var a,t,e,n,o,i=12,r=$("#christmas .close-btn");o=function(){$("#christmas").hide(),localStorage.christmasDefault=1},r.on("click",function(){o()}),a=Date.parse(new Date),t=14825808e5,e=14826816e5,1!=localStorage.christmasDefault&&parseInt(a)>t&&parseInt(a)<e&&$("#christmas").show(),(n=function(a){r.html("跳过动画("+a+")"),0==a?o():(setTimeout(function(){n(a)},1e3),a--)})(i)};g()});