$(function(){function e(e){var a=new Date(e).getTime(),i=6e4,t=60*i,n=24*t,s=30*n,r=(new Date).getTime(),l=r-a;if(!(0>l)){var o=l/s,c=l/(7*n),u=l/n,d=l/t,f=l/i;return o>=1?result=""+parseInt(o)+"月前":c>=1?result=""+parseInt(c)+"周前":u>=1?result=""+parseInt(u)+"天前":d>=1?result=""+parseInt(d)+"小时前":f>=1?result=""+parseInt(f)+"分钟前":result="刚刚",result}}var a="http://games.aixifan.com/",i="",t="",n=0,s=6,r=0,l=0,o=10,c=$("#slider-big"),u=$("#slider-bigger").length;u&&(c=$("#slider-bigger"));var d=c.find(".slider-item"),f=c.find(".slider-con"),h=d.length;if(h>1){for(var g="",m=0;h>m;m++)g+="<span></span>";u||c.append('<div class="slider-count">'+g+"</div>");var v,p=0,w=function(e){var a=d.width();f.width(d.width()*h),f.stop(!0,!0).animate({left:-a*e}),c.find(".slider-count span").eq(e).addClass("active").siblings("span").removeClass("active")},k=function(){v=setInterval(function(){w(p),p>=h-1?p=0:p++},2e3)};w(0),k(),c.hover(function(){clearInterval(v),p--},function(){p>=h-1?p=0:p++,k()}),u?c.on("mouseover",".slider-count span",function(){p=$(this).index(),w(p)}):c.on("click",".slider-count span",function(){p=$(this).index(),w(p)}),$(".btnL").on("click",function(){var e=$(".slider-count span.active").index();0==e?$(".slider-count span").eq(h-1).click():$(".slider-count span").eq(e-1).click(),clearInterval(v)}),$(".btnR").on("click",function(){var e=$(".slider-count span.active").index();e==h-1?$(".slider-count span").eq(0).click():$(".slider-count span").eq(e+1).click(),clearInterval(v)})}$.user.isLogin()&&$(".user-avatar").show(),$(window).resize(function(){var e=$(".slider-count").width(),a=$(".slider-big").width(),i=(a-e)/2;$(".slider-count").css({right:i})}).resize();var b=function(){var e="";0==r?e=".all":1==r?e=".news":2==r?e=".hot":3==r&&(e=".web"),$(e).find(".gameList .listBox").mousemove(function(e){var e=e?e:window.event,a=$(this),i=e.pageY-a.offset().top,t=e.pageX-a.offset().left;a.find(".listpop").css({display:"block",top:i+10+"px",left:t+10+"px"})}),$(e).find(".gameList .listBox").mouseleave(function(){$(this).find(".listpop").css({display:"none"})})};b();var _=function(t,n){var s,r=$("#list-message").html(),l="",o="",c="",u="";t=String(t),n=String(n),s=""==i?"_afOther="+JSON.stringify({limit:[t,n]})+"&_afGet="+JSON.stringify({num:"1"}):"_afOther="+JSON.stringify({limit:[t,n]})+"&_afWhere="+JSON.stringify({type:i})+"&_afGet="+JSON.stringify({num:"1"}),$.ajax({type:"get",url:a+"api/game/inform",data:s,crossdomain:!0}).done(function(a){if(0==a.errorid){var i=a.vdata.result,t=a.vdata.num,s="http://www.acfun.cn";if(i.length>0){for(var d=0;d<i.length;d++)"0"==i[d].flag?(c=s+"/v/"+i[d].addre,o=""):"1"==i[d].flag?(c=s+"/a/"+i[d].addre,o=""):"2"==i[d].flag?(c=s+"/v/"+i[d].addre,o=""):"3"==i[d].flag?(c=s+"/a/"+i[d].addre,o=""):"4"==i[d].flag?(c=s+"/u/"+i[d].addre,o=""):"8"==i[d].flag?(c=i[d].addre,o=""):"16"==i[d].flag?(c=i[d].addre,o="<image src='"+i[d].icon+"'/>"):"17"==i[d].flag&&(c="/package/#giftId="+i[d].addre,o="<image src='"+i[d].icon+"'/>"),u="notice"==i[d].type?"notice":"",l+=$.parseTemp(r,{url:c,avatar:"<image src='"+i[d].headImg+"'/>",content:i[d].content,nice:i[d].nice,text:i[d].text,date:e(1e3*i[d].createAt),icon:o,clas:u});t>n?($(".message-box .refresh").show(),y(t)):$(".message-box .refresh").hide(),$(".message-box .listMessage").html(l)}else $(".message-box .listMessage").html(""),$(".message-box .refresh").hide()}})};_(0,6),$(".mes-tab").on("click","a",function(){var e=$(this);e.addClass("active").siblings().removeClass("active"),i=e.data().con,n=0,s=6,_(n,s)});var y=function(e){$(".message-box .refresh").off().on("click",function(){n+=s,n>6*Math.ceil(e/s-1)?(n=0,s=6,_(n,s)):_(n,s)})},x=$.cookie("auth_key"),C=$.cookie("auth_key_ac_sha1"),J=$.cookie("auth_key_ac_sha1_")?encodeURIComponent($.cookie("auth_key_ac_sha1_").replace(/\s/g,"+")):"",L=function(e,i){var n,s=$("#temp-flash").html(),r="",l="";e=String(e),i=String(i),n=1==t?"like=1&auth_key="+x+"&auth_key_ac_sha1="+C+"&auth_key_ac_sha1_="+J+"&_afGet="+JSON.stringify({num:"1"})+"&_afOther="+JSON.stringify({limit:[e,i]}):"auth_key="+x+"&auth_key_ac_sha1="+C+"&auth_key_ac_sha1_="+J+"&_afGet="+JSON.stringify({num:"1"})+"&_afOther="+JSON.stringify({limit:[e,i]}),$.ajax({type:"get",url:a+"api/game/flash",data:n,crossdomain:!0}).done(function(e){if(0==e.errorid){var a=e.vdata.result,n=e.vdata.num;if(a.length>0){for(var o=0;o<a.length;o++)l=1==t?"active":a[o].like?"active":"",r+=$.parseTemp(s,{url:a[o].url,title:a[o].title,id:a[o]._afid,like:l});$(".flash-list .flash-box").html(r),n>i?($(".flash-list .refresh").removeClass("hidden"),N(n)):$(".flash-list .refresh").addClass("hidden")}else $(".flash-list .flash-box").html(""),$(".flash-list .refresh").addClass("hidden")}}).fail(function(){})};L(0,10),$(".message-tab").on("click","a",function(){var e=$(this);e.addClass("active").siblings().removeClass("active"),t=e.data().con,l=0,o=10,1==t?$.user.isLogin()?L(l,o):window.location.href="http://www.acfun.cn/login/?returnUrl="+location.href:L(l,o)});var N=function(e){$(".flash-list .refresh").off().on("click",function(){l+=o,l>10*Math.ceil(e/o-1)?(l=0,o=10,L(l,o)):L(l,o)})};$(".flash-list").on("click",".gameImg",function(){var e=$(this),i=e.parent().data().id,t=e.siblings("a").attr("href");$.user.isLogin()?$.ajax({type:"get",url:a+"api/game/likef?flash_id="+i+"&auth_key="+x+"&auth_key_ac_sha1="+C+"&auth_key_ac_sha1_="+J}).done(function(a){0==a.errorid&&(e.hasClass("active")?(e.removeClass("active"),O("DianJiH5YouXiLieBiaoQuXiaoXiHuan",t)):(e.addClass("active"),O("DianJiH5YouXiLieBiaoXiHuan",t)))}):window.location.href="http://www.acfun.cn/login/?returnUrl="+location.href}),$(".listTab").on("click","a",function(){switch($(this).addClass("active").siblings("a").removeClass("active"),r=$(this).data().con,b(),r){case 0:$(".all").show(),$(".news,.hot,.web").hide();break;case 1:$(".news").show(),$(".all,.hot,.web").hide();break;case 2:$(".hot").show(),$(".all,.news,.web").hide();break;default:$(".web").show(),$(".all,.news,.hot").hide()}});var S=function(e){for(var a,t=$(".all,.news,.hot,.web"),n=0;n<t.length;n++)if(!$(t[n]).is(":hidden"))switch(a=$(t[n]),n){case 0:i="all";break;case 1:i="news";break;case 2:i="hot";break;case 3:i="web"}var s=8*(e.pageNum-1);$.ajax({type:"get",url:"/game/next?type="+i+"&pageNo="+s,xhrFields:{withCredentials:!0}}).done(function(t){if(t=t.data){var n=t.page,s=t.html,r=$.makePager({num:e.pageNum,count:n,size:8,total:n/8,addon:!0,hasjumpPage:!0});$("#list-pager-"+i).html(r),a.find(".gameList").html(s),b()}}).fail(function(){a.find(".gameList").html("<div id='emotion'><img src='"+window.globalConfig.oldPath+"/umeditor/dialogs/emotion/images/ac/"+$.randomNumber(1,54)+".gif'/><div id='list'>获取列表失败，请于稍后重试。</div></div>"),$("#list-pager-"+i).html(" ")})},I=function(){for(var e=1,a=8,i=[pageCount.all,pageCount.news,pageCount.hot,pageCount.web],t=0;t<i.length;t++)if(i[t]){var n=$.makePager({num:e,count:i[t],size:a,total:i[t]/a,addon:!0,hasjumpPage:!1});0==t?($("#list-pager-all").html(n),$("#list-pager-all").readyPager({addon:!0,callback:function(e){return S({pageNum:e})}})):1==t?($("#list-pager-news").html(n),$("#list-pager-news").readyPager({addon:!0,callback:function(e){return S({pageNum:e})}})):2==t?($("#list-pager-hot").html(n),$("#list-pager-hot").readyPager({addon:!0,callback:function(e){return S({pageNum:e})}})):3==t&&($("#list-pager-web").html(n),$("#list-pager-web").readyPager({addon:!0,callback:function(e){return S({pageNum:e})}}))}};I();var O=function(e,a,i,t){var n="";n=null==$.user.uid?0:$.user.uid,window.sa&&sa.track(e,{product:"web",UID:String(n),channel:$.getQueryString("channel")||"",userLevel:null==$.user.getGroupLevel()?"-1":String($.user.getGroupLevel()),client:"Web",target:a,page:"PC_GC"})},P=function(){var e="";e=null==$.user.uid?0:$.user.uid,window.sa&&sa.setProfile({distinct_id:"",product:"web",uid:String(e),channel:$.getQueryString("channel")||""})};P(),O("Gm_Pc_Pageview",""),$("#slider-big").on("click","a",function(){var e=$(this).attr("href");O("DianJiLunBo",e)}),$(".entrance").on("click",function(){var e=$(this).attr("href");O("DianJiLiBaoRuKou",e)}),$(".list-box").on("click",".box-img a,.download",function(){var e=$(this).attr("href");O("TuiJianYouXiXiaZai",e)}),$(".listTab").on("click",function(){var e=$(this).data("con");O("YouXiLieBiaoDIanJi",e)}),$(".listBox").on("click",".appointment",function(){var e=$(this).attr("href");O("LieBiaoAnNiu",e)}),$(".game-advertise").on("click",function(){var e=$(this).attr("href");O("HengFuDianJi",e)}),$(".listMessage").on("click",".mes-list",function(){var e=$(this).data().url;O("XiaoXiDianJi",e)}),$(".flash-box").on("click","a",function(){var e=$(this).attr("href");O("DianJiH5YouXiLieBiao",e)})});