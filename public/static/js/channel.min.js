$(function(){$("img[data-original]").lazyload({threshold:200,effect:"fadeIn",failurelimit:20}),$(".block-video .has-danmu").showDanmu(),$(".module-video-big .has-danmu").showDanmu({lines:5,lineHeight:30});var a=function(a,n,e){var o=a,i=o.data().nav,t=o.closest("[data-tab]");n&&n(),o.addClass("active").siblings("a").removeClass("active"),t.find("[data-con]").addClass("hidden").filter('[data-con="'+i+'"]').removeClass("hidden")};$("[data-nav]").click(function(){var n=$(this),e=n.data().nav,o=n.closest("[data-tab]");o.hasClass("module-article")?a(n,function(){if(n.hasClass("active")){var a="/v/list"+e+"/index.htm";a=window.globalConfig.rootDomain?window.globalConfig.rootDomain+a:a,n.attr("href",a).attr("target","_blank")}else n.attr("href","javascript:;").removeAttr("target")}):a(n)});var n=$("#slider-big"),e=$("#slider-bigger").length;e&&(n=$("#slider-bigger"));var o=n.find(".slider-item"),i=n.find(".slider-con"),t=o.length,l="",s="",c="";if(e&&(l=$(".slider-count #slider-title .slider-title"),s=l.find(".slider-title-item"),c=s.width()),t>1){for(var d="",r=0;t>r;r++)d+="<span>"+(r+1)+"</span>";e||n.append('<div class="slider-count">'+d+"</div>");var f,u=0,p=function(a){var s=o.width();i.width(o.width()*t),i.stop(!0,!0).animate({left:-s*a}),n.find(".slider-count span").eq(a).addClass("active").siblings("span").removeClass("active"),e&&(l.width(c*t),l.stop(!0,!0).animate({left:-c*a}))},m=function(){f=setInterval(function(){p(u),u>=t-1?u=0:u++},3e3)};p(0),m(),n.hover(function(){clearInterval(f),u--},function(){u>=t-1?u=0:u++,m()}),e?n.on("mouseover",".slider-count span",function(){u=$(this).index(),p(u)}):n.on("click",".slider-count span",function(){u=$(this).index(),p(u)})}var g=$(".area-header .area-change-btn");if(g.on("click",function(){var a=$(this);if(!a.hasClass("loading")){var n=a.closest("[data-tab]"),e=n.find(".video-main").data().pagenum,o=parseInt(n.find("[data-con].active").data().con),i=a.closest(".area-change-btn"),t=n.find(".video-main");if($(i).addClass("loading"),1!=t.data().pagenum&&4>o)o++,n.find("[data-con]").removeClass("active").addClass("hidden").filter('[data-con="'+o+'"]').removeClass("hidden").addClass("active"),n.find(".area-main").eq(o).find("img[data-original]").lazyload({threshold:200,effect:"fadeIn",failurelimit:20}),setTimeout(function(){$(i).removeClass("loading")},1e3);else{var l=a.closest("[data-cid]");$(i).addClass("loading"),$.get("/channel/area",{channelId:l.data().cid,pageNum:e,pageSize:l.data().size}).done(function(a){t.data().pagenum=e+1,l.find("section.video-main").html(a.data),$(i).removeClass("loading"),n.find(".area-main").eq(0).find("img[data-original]").lazyload({threshold:200,effect:"fadeIn",failurelimit:20})})}}}),$.user.isLogin())for(var h=$("#fame-hall").find("[data-uid]"),r=0;r<h.length;r++){var v=$(h[r]).data().uid,w=$(h[r]).find("span.follow");!function(a){$.ajax({type:"get",url:"/api/friend.aspx",data:{name:"checkFollow",userId:v},success:function(n){n.success?n.isFollowing&&(a.html("已关注"),a.data().active=1,a.css({color:"#999",background:"#eee"})):(a.data().active=0,a.html("+关注"))}})}(w)}var b=$("#fame-hall"),k=$("#shade-layer");$("#pop-login");b.on("click",".follow",function(){var a=$(this);if($.user.isLogin())if(0==a.data().active){var n=$("#temp-item-follow").html(),e=$("#ipt-group-follow");$.get("/api/friend.aspx",{name:"getGroupList"}).done(function(o){if(o.success){var i="";o=o.groupList;for(var t in o)i+=$.parseTemp(n,{gid:o[t].groupId,count:o[t].groupCount||0,name:o[t].groupName||"非法分组"});e.html(i),$.callPop("follow","open","","关注&nbsp;&nbsp;"+a.data().name,function(){$.post("/api/friend.aspx",{name:"follow",username:a.data().name,userId:a.data().userid,groupId:e.val()}).done(function(n){n.success?(a.html("已关注"),a.data().active=1,a.css({color:"#999",background:"#eee"}),$.info.success("向["+$.trim(e.find("option:selected").text().replace(/\(.*/,""))+"]中添加关注["+a.data().name+"]成功",3e3)):$.info.warning("关注数量超过1024或者用户已关注",3e3),$.callPop("follow","close","","","")}).fail(function(){$.info.warning("关注数量超过1024或者用户已关注",3e3)})})}})}else $.callPop("confirm","open","","是否确定取消关注？",function(){$.post("/api/friend.aspx?name=unfollow",{username:a.data().name,userId:a.data().userid,groupId:0}).done(function(n){n.success?(a.html("+关注"),a.data().active=0,a.css({color:"#fd4c5b",background:"#fff"}),$.info.success("已取消对["+a.data().name+"]关注",3e3)):$.info.warning("取消失败",3e3),$.callPop("confirm","close","","","")}).fail(function(){$.info.warning("取消关注失败",3e3)})});else window.location.href=globalConfig.rootDomain+"/login/?returnUrl="+location.href}),$("#pop-login").on("click","#area-login-btn",function(){var a=$(".form-login"),n=0|$.cookie("ac_login_error")||0,e=!1,o="",i=a.find(".area1 input").val(),t=a.find(".area2 input").val();n>3&&($$("#area-captcha-login").removeClass("hidden"),$$("#ipt-captcha-login").attr({disabled:!1}),e=!0),e&&(o=$.trim($("#ipt-captcha-login").val())),$.post("/login.aspx",{username:i,password:t,captcha:o}).done(function(a){location.href=location.href.replace(/#.*/,"")})}),k.on("click",function(){$.callPop("","close","","","")}),$.callPop=function(a,n,e,o,i){var t=$(".pop"),l=$(window).scrollTop()+200,s=$(window).width()/2-170;switch(t.css({top:l,left:s}),a){case"confirm":e=$("#pop-confirm");break;case"login":e=$("#pop-login");break;case"follow":e=$("#pop-follow");break;default:e=$(".pop")}switch(n){case"close":t.hide(),k.hide();break;case"open":var c=e.find(".win-hint-ensure");c.html(o),e.show(),k.show()}switch(a){case"confirm":setTimeout(function(){$("#btn_ok_ensure").off(),$("#btn_cancle_ensure").off(),$("#btn_ok_ensure").on("click",function(){"function"==typeof i?i():console.info("callback:not a function.")}),$("#btn_cancle_ensure").on("click",function(){$.callPop(a,"close","","","")})},500);break;case"follow":setTimeout(function(){$("#btn-do-follow").off(),$("#win-btn-close").off(),$("#btn-do-follow").on("click",function(){"function"==typeof i?i():console.info("callback:not a function.")}),$("#win-btn-close").on("click",function(){$.callPop(a,"close","","","")})},500)}}});